<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>题库 - 冻梨OJ</title>
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/all_questions.css">
    <script>
        // XSS防护
        function escapeHtml(text) {
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
            return text ? text.replace(/[&<>"']/g, function(m) { return map[m]; }) : '';
        }

        // 更新导航栏状态
        function updateNavAuth(data) {
            const authContainer = document.getElementById('auth-container');
            if (data.status === 0 && data.username) {
                authContainer.innerHTML = `
                    <div class="user-profile">
                        <div class="user-avatar">${data.username.charAt(0).toUpperCase()}</div>
                        <span>${escapeHtml(data.username)}</span>
                    </div>
                `;
            } else {
                authContainer.innerHTML = `<a href="/login" class="btn-text">登录 / 注册</a>`;
            }
        }

        window.onload = function() {
            // 获取用户信息
            fetch('/api/user')
                .then(res => res.json())
                .then(data => updateNavAuth(data))
                .catch(() => updateNavAuth({status: -1}));
        };
    </script>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="/">
                <span>&lt;/&gt;</span> 冻梨OJ
            </a>
        </div>
        <div class="navbar-links">
            <a href="/">首页</a>
            <a href="/all_questions" class="active">题库</a>
            <a href="#">竞赛</a>
            <a href="#">讨论</a>
            <a href="#">求职</a>
        </div>
        <div class="navbar-auth" id="auth-container">
            <span class="btn-text loading">加载中...</span>
        </div>
    </nav>

    <div class="question-list-container">
        <div class="question-list-header">
            <h1>题库列表</h1>
            <p style="color: var(--text-secondary);">挑选适合你的题目进行挑战</p>
        </div>

        <table class="question-table">
            <thead>
                <tr>
                    <th style="width: 80px;">编号</th>
                    <th>标题</th>
                    <th style="width: 100px;">难度</th>
                </tr>
            </thead>
            <tbody>
                {{#question_list}}
                <tr>
                    <td>{{number}}</td>
                    <td><a href="/question/{{number}}" class="question-link">{{title}}</a></td>
                    <td><span class="difficulty-badge difficulty-{{star}}">{{star}}</span></td>
                </tr>
                {{/question_list}}
            </tbody>
        </table>

        <div class="footer">
            &copy; 2026 冻梨在线判题平台
        </div>
    </div>
</body>
</html>
